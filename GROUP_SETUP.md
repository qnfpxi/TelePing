# 群组配置快速指南

## ✅ 当前已支持群组操作

无需修改代码，只需要配置 `config.json` 即可！

---

## 🚀 快速配置步骤

### 步骤 1：将 Bot 添加到群组

1. 打开你的 Telegram 群组
2. 点击群组名称 → "添加成员"
3. 搜索你的 Bot 用户名
4. 添加成功

**推荐**：给 Bot 管理员权限（避免消息接收问题）
- 群组设置 → 管理员 → 添加管理员 → 选择你的 Bot

---

### 步骤 2：获取群组 Chat ID

**方法一：使用 API**

1. 在群组中发送任意消息（如：`Hello Bot`）
2. 打开浏览器访问：
   ```
   https://api.telegram.org/bot<YOUR_BOT_TOKEN>/getUpdates
   ```
3. 找到类似这样的内容：
   ```json
   {
     "message": {
       "chat": {
         "id": -1001234567890,  ← 这就是群组 Chat ID
         "title": "我的监控群组",
         "type": "supergroup"
       }
     }
   }
   ```

**方法二：使用专用 Bot**

1. 在群组中添加 **@getidsbot** 或 **@userinfobot**
2. Bot 会自动回复群组 ID

**注意**：群组 Chat ID 是**负数**（如 `-1001234567890`）

---

### 步骤 3：配置 `config.json`

编辑 `config.json`，将群组 ID 添加到白名单：

```json
{
  "telegram_bot_token": "YOUR_BOT_TOKEN",
  "telegram_chat_id": "-1001234567890",
  "allowed_chat_ids": ["-1001234567890"],
  ...
}
```

**配置说明**：
- `telegram_chat_id`：告警发送目标（群组 ID）
- `allowed_chat_ids`：允许操作 Bot 的白名单（群组 ID）

---

### 步骤 4：测试

重启服务后，在群组中发送：

```
/list
```

**预期效果**：
- ✅ 群组内任何成员发送 `/list` → Bot 回复监控列表
- ✅ 群组内任何成员发送 `/add` → 成功添加站点
- ✅ 站点故障 → 告警消息发到群组

---

## 🎯 推荐配置场景

### 场景 1：小团队内部使用（推荐）

**适用**：2-5 人的小团队，成员互相信任

```json
{
  "telegram_chat_id": "-1001234567890",      // 告警发到群组
  "allowed_chat_ids": ["-1001234567890"]     // 群组内所有人都能操作
}
```

**优点**：
- ✅ 告警在群组内公开，所有人可见
- ✅ 任何成员都能添加/删除站点
- ✅ 操作透明，互相监督

---

### 场景 2：大团队（安全型）

**适用**：10 人以上的团队，需要权限控制

```json
{
  "telegram_chat_id": "-1001234567890",      // 告警发到群组
  "allowed_chat_ids": [
    "123456789",    // 管理员 A（个人 ID）
    "987654321"     // 管理员 B（个人 ID）
  ]
}
```

**优点**：
- ✅ 告警在群组内公开
- ✅ 只有指定的管理员能私聊 Bot 操作
- ✅ 群组成员无法添加/删除站点

---

### 场景 3：混合模式

**适用**：既想要群组公开操作，又需要个人管理

```json
{
  "telegram_chat_id": "-1001234567890",
  "allowed_chat_ids": [
    "123456789",        // 你个人（私聊操作）
    "-1001234567890"    // 群组（群内操作）
  ]
}
```

**优点**：
- ✅ 你可以私聊 Bot 操作
- ✅ 群组成员也可以在群内操作
- ✅ 告警发到群组

---

## ⚠️ 注意事项

### 1. 群组权限

如果配置了群组 ID 到白名单：
- ✅ **群组内所有成员**都能操作 Bot
- ⚠️ 包括新加入的成员
- ⚠️ 无法限制特定成员

**建议**：
- 小团队（<5人）：直接使用群组 ID
- 大团队（>10人）：只添加个人管理员 ID

### 2. Bot 管理员权限

**强烈建议**给 Bot 管理员权限：
- 某些群组设置可能阻止 Bot 接收消息
- 管理员权限确保 Bot 能看到所有命令
- 不需要删除消息等其他权限

### 3. 隐私考虑

群组模式下：
- ⚠️ 所有成员都能看到监控的网址
- ⚠️ 所有成员都能看到告警信息
- ⚠️ 操作日志在群组内公开

**如果网址敏感**：建议使用"个人操作 + 群组告警"模式

---

## 🧪 测试清单

配置完成后，请测试：

- [ ] Bot 已添加到群组
- [ ] Bot 是群组管理员（推荐）
- [ ] 群组 ID 已添加到 `allowed_chat_ids`
- [ ] 在群组中发送 `/list` 有响应
- [ ] 在群组中发送 `/add` 能成功添加站点
- [ ] 告警消息能发送到群组

---

## 📝 群组操作示例

### 在群组中添加站点

```
你: /add 官网 www.example.com
Bot: ✅ 添加成功: 官网 (www.example.com)
```

### 在群组中批量添加站点

```
你: /addmany 官网,www.example.com,backup.example.com,cdn.example.com
Bot: ✅ 批量添加成功！
     • 官网-1 → www.example.com
     • 官网-2 → backup.example.com
     • 官网-3 → cdn.example.com

     共添加 3 个站点
```

### 在群组中查看站点

```
你: /list
Bot: 当前监控列表：
     • 官网 → www.example.com
     • API服务 → api.example.com
```

### 在群组中删除站点

```
你: /delete 官网
Bot: ✅ 删除成功: 官网
```

### 告警消息（发到群组）

```
Bot: ⚠️ 网站故障告警
     站点: 官网 (www.example.com)
     异常占比: 35.60%

     【异常详情】
     DNS解析失败(0.0.0.0): 北京(3) 上海(2) 广东(3)
     DNS劫持(127.x.x.x): 河南(2) 湖北(1)
     连接超时/丢包100%: 四川(1) 云南(2)

     受影响运营商: 电信5 联通3 移动8 其他0
     检测时间: 2025-12-24 21:30:15
```

---

## ❓ 常见问题

### Q1：Bot 在群组中不响应命令？

**原因**：Bot 没有接收消息的权限

**解决**：
1. 给 Bot 管理员权限
2. 或检查群组隐私设置：设置 → 群组类型 → 允许机器人接收消息

### Q2：想限制群组内的特定成员操作？

**现状**：当前不支持

**替代方案**：
- 方案 A：只添加个人 ID 到白名单，不添加群组 ID
- 方案 B：使用两个群组（管理群 + 展示群）

### Q3：可以同时配置多个群组吗？

**可以**：

```json
{
  "allowed_chat_ids": [
    "-1001111111111",  // 监控管理群
    "-1002222222222",  // 运维团队群
    "123456789"        // 你个人
  ]
}
```

所有这些群组和个人都能操作 Bot

---

## 🎉 完成

配置完成后，你的监控系统现在支持：
- ✅ 群组内公开操作
- ✅ 群组内展示告警
- ✅ 多成员协同管理
- ✅ 操作透明可追溯

**开始使用吧！** 🚀
